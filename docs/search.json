[
  {
    "objectID": "notebooks/user_guide_template.html",
    "href": "notebooks/user_guide_template.html",
    "title": "Data User Guide Template",
    "section": "",
    "text": "TOPST SCHOOL project: https://ciesin-geospatial.github.io/TOPSTSCHOOL-SPHINX/\n\nSpecific lesson: NRT Water Lesson: https://ciesin-geospatial.github.io/TOPSTSCHOOL-water/m102-lance-modis-nrt-global-flood.html\n\nPytidycensus examples page: https://github.com/mmann1123/pytidycensus/tree/main/examples\nNASA Earthdata Cloud Cookbook: https://nasa-openscapes.github.io/earthdata-cloud-cookbook/tutorials/\nGSAPP Smorgasbord: https://cdp.arch.columbia.edu/smorgasbord/modules/5-computational-design-modeling-in-grasshopper/5-7_Design-Space/\n\n\n\n\n\nProvide links to any relevant URLs including code packages, data documentation\nProvide links to other help/guides when relevant instead of DIY. For example, link to a guide on accessing REST APIs instead of writing a whole section yourself. Two options for this:\n\nhttps://zapier.com/blog/how-to-use-api/#what\nhttps://guides.dataverse.org/en/6.8/api/getting-started.html\n\nUse open source tools whenever possible to facilitate user accessibility. Where an open tool is not available, explain why the tool is necessary and point to some possible alternatives\n\n\n\n\n\n\n\n\nBrief, plain-language description of the dataset\n\nLinks to our datahub, API\n\nTime period covered\n\nGeographic or population coverage\n\nLicense (e.g., CC BY 4.0)\nCitation guidance\nAny usage restrictions\n\n\n\n\n\nIntended audience\nSuggested skill level (beginner / intermediate / advanced)\n\n\n\n\n\n\nList 5‚Äì6 example questions users can explore, in addition to the key question that we will be exploring in this guide.\n\nHow has X changed over time?\nAre there differences in X by region or demographic group?\nWhich areas experience the highest or lowest values?\n\nExplain why this data set is appropriate to use to assess the key question.\n\n\n\n\n\n\n\nLink(s) to download location (portal, GitHub, API, cloud storage)\nFile formats available (CSV, Excel, Parquet, API endpoint)\n\n\n\n\nStep-by-step instructions: 1. Navigate to ‚Ä¶ 2. Click ‚Ä¶ 3. Select format ‚Ä¶\n\nInclude screenshots if possible.\n\n\n\n\n\n\n\n\n\n\n\nFile Name\nDescription\n\n\n\n\ndata.csv\nMain cleaned dataset\n\n\ncodebook.csv\nVariable definitions\n\n\nmetadata.json\nCollection and methodology details\n\n\n\n\n\n\nClearly state what one row represents:\n\nOne road\n\nOne ward\n\nOne health facility\nEtc\n\n\n\n\n\n\n\n\nHighlight the most important fields.\n\n\n\nVariable\nDescription\nType\nExample\n\n\n\n\ncounty\nCounty name\nCategorical\nCook\n\n\nyear\nCalendar year\nInteger\n2022\n\n\nfunding_usd\nTotal funding\nNumeric\n125000\n\n\n\n\n\n\n\nHow missing values are represented (e.g., NA, blank, -999)\nKnown gaps or limitations\n\n\n\n\n\n\n\nKnown sources of bias\nData collection limitations\nChanges in methodology over time\nWhat the data should not be used for\n\n\n\n\n\n\n\n\nR (which packages?)\nPython (which packages?)\nArcGIS Pro / QGIS\nExcel / Google Sheets\nLocal computing requirements (if any) - provide alternatives to local processing\n\nJupyterLab/CoLab\n\n\n\n\n\n\n\n\n\nSubset to year or area of interest\n\n\n\n\n\nCalculate summary statistics",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#examples",
    "href": "notebooks/user_guide_template.html#examples",
    "title": "Data User Guide Template",
    "section": "",
    "text": "TOPST SCHOOL project: https://ciesin-geospatial.github.io/TOPSTSCHOOL-SPHINX/\n\nSpecific lesson: NRT Water Lesson: https://ciesin-geospatial.github.io/TOPSTSCHOOL-water/m102-lance-modis-nrt-global-flood.html\n\nPytidycensus examples page: https://github.com/mmann1123/pytidycensus/tree/main/examples\nNASA Earthdata Cloud Cookbook: https://nasa-openscapes.github.io/earthdata-cloud-cookbook/tutorials/\nGSAPP Smorgasbord: https://cdp.arch.columbia.edu/smorgasbord/modules/5-computational-design-modeling-in-grasshopper/5-7_Design-Space/",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#tips-and-pointers",
    "href": "notebooks/user_guide_template.html#tips-and-pointers",
    "title": "Data User Guide Template",
    "section": "",
    "text": "Provide links to any relevant URLs including code packages, data documentation\nProvide links to other help/guides when relevant instead of DIY. For example, link to a guide on accessing REST APIs instead of writing a whole section yourself. Two options for this:\n\nhttps://zapier.com/blog/how-to-use-api/#what\nhttps://guides.dataverse.org/en/6.8/api/getting-started.html\n\nUse open source tools whenever possible to facilitate user accessibility. Where an open tool is not available, explain why the tool is necessary and point to some possible alternatives",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#overview",
    "href": "notebooks/user_guide_template.html#overview",
    "title": "Data User Guide Template",
    "section": "",
    "text": "Brief, plain-language description of the dataset\n\nLinks to our datahub, API\n\nTime period covered\n\nGeographic or population coverage\n\nLicense (e.g., CC BY 4.0)\nCitation guidance\nAny usage restrictions\n\n\n\n\n\nIntended audience\nSuggested skill level (beginner / intermediate / advanced)",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#key-questions-this-data-can-answer",
    "href": "notebooks/user_guide_template.html#key-questions-this-data-can-answer",
    "title": "Data User Guide Template",
    "section": "",
    "text": "List 5‚Äì6 example questions users can explore, in addition to the key question that we will be exploring in this guide.\n\nHow has X changed over time?\nAre there differences in X by region or demographic group?\nWhich areas experience the highest or lowest values?\n\nExplain why this data set is appropriate to use to assess the key question.",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#data-access",
    "href": "notebooks/user_guide_template.html#data-access",
    "title": "Data User Guide Template",
    "section": "",
    "text": "Link(s) to download location (portal, GitHub, API, cloud storage)\nFile formats available (CSV, Excel, Parquet, API endpoint)\n\n\n\n\nStep-by-step instructions: 1. Navigate to ‚Ä¶ 2. Click ‚Ä¶ 3. Select format ‚Ä¶\n\nInclude screenshots if possible.",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#dataset-structure",
    "href": "notebooks/user_guide_template.html#dataset-structure",
    "title": "Data User Guide Template",
    "section": "",
    "text": "File Name\nDescription\n\n\n\n\ndata.csv\nMain cleaned dataset\n\n\ncodebook.csv\nVariable definitions\n\n\nmetadata.json\nCollection and methodology details\n\n\n\n\n\n\nClearly state what one row represents:\n\nOne road\n\nOne ward\n\nOne health facility\nEtc",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#variables-definitions",
    "href": "notebooks/user_guide_template.html#variables-definitions",
    "title": "Data User Guide Template",
    "section": "",
    "text": "Highlight the most important fields.\n\n\n\nVariable\nDescription\nType\nExample\n\n\n\n\ncounty\nCounty name\nCategorical\nCook\n\n\nyear\nCalendar year\nInteger\n2022\n\n\nfunding_usd\nTotal funding\nNumeric\n125000\n\n\n\n\n\n\n\nHow missing values are represented (e.g., NA, blank, -999)\nKnown gaps or limitations",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#data-quality-limitations",
    "href": "notebooks/user_guide_template.html#data-quality-limitations",
    "title": "Data User Guide Template",
    "section": "",
    "text": "Known sources of bias\nData collection limitations\nChanges in methodology over time\nWhat the data should not be used for",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/user_guide_template.html#getting-started-quick-setup",
    "href": "notebooks/user_guide_template.html#getting-started-quick-setup",
    "title": "Data User Guide Template",
    "section": "",
    "text": "R (which packages?)\nPython (which packages?)\nArcGIS Pro / QGIS\nExcel / Google Sheets\nLocal computing requirements (if any) - provide alternatives to local processing\n\nJupyterLab/CoLab\n\n\n\n\n\n\n\n\n\nSubset to year or area of interest\n\n\n\n\n\nCalculate summary statistics",
    "crumbs": [
      "Home",
      "Data Access",
      "Data User Guide Template"
    ]
  },
  {
    "objectID": "notebooks/api_nga_network.html",
    "href": "notebooks/api_nga_network.html",
    "title": "GRID3 Nigeria Road Network Analysis",
    "section": "",
    "text": "The CIESIN GRID3 data provides high-resolution geospatial data that can be used to analyze various aspects of infrastructure and services in Nigeria. One practical application of this data is to find optimal routes between schools and health facilities. Below is an example of how to achieve this using Python and relevant libraries.\n  \n\n# install neccessary packages\n# !pip install osmnx\n# !pip install mapclassify\n# !pip install folium\n# !pip install momepy\n\n\n# import\nimport geopandas as gpd\nimport networkx as nx\nimport momepy\nimport osmnx as ox\nimport matplotlib.pyplot as plt\nfrom itertools import product\nimport numpy as np\nimport mapclassify\nimport folium\nimport json\nimport pandas as pd\nimport momepy \nimport requests \nimport random\nimport matplotlib.colors as mcolors\n\n\n# install arcgis API for accessing data\n# check that arcgis is installed \n# !pip install arcgis\n    \n\nRequirement already satisfied: arcgis in c:\\users\\jfm2205\\appdata\\local\\esri\\conda\\envs\\jfm-py2\\lib\\site-packages (2.4.1.1)\n\n\n\n# import arcgis\nfrom arcgis.gis import GIS \n\n\n# Anonymously authenticate arcgis API\ngis = GIS()\n\n\ndef fetch_nga_roads(bbox, crs, record_limit, url):\n    \"\"\"\n    Fetch NGA roads from an ArcGIS FeatureServer within a bounding box.\n\n    Parameters\n    ----------\n    bbox : dict\n        Bounding box with keys xmin, ymin, xmax, ymax (in EPSG:3857).\n    crs : str, optional\n        CRS for the output GeoDataFrame (default: EPSG:3857).\n    record_limit : int, optional\n        Maximum number of records per request (default: 200000).\n    url : str, optional\n        ArcGIS FeatureServer query URL.\n\n    Returns\n    -------\n    geopandas.GeoDataFrame\n        GeoDataFrame containing all fetched road features.\n    \"\"\"\n\n    params = {\n        \"f\": \"geojson\",\n        \"where\": \"1=1\",\n        \"geometry\": json.dumps({\n            **bbox,\n            \"spatialReference\": {\"wkid\": int(crs.split(\":\")[1])},\n        }),\n        \"geometryType\": \"esriGeometryEnvelope\",\n        \"spatialRel\": \"esriSpatialRelContains\",\n        \"outFields\": \"*\",\n        \"returnGeometry\": \"true\",\n        \"resultRecordCount\": record_limit,\n    }\n\n    all_features = []\n    offset = 0\n\n    while True:\n        paged_params = params | {\"resultOffset\": offset}\n        r = requests.get(url, params=paged_params)\n        r.raise_for_status()\n\n        data = r.json()\n        features = data.get(\"features\", [])\n\n        if not features:\n            break\n\n        all_features.extend(features)\n        offset += len(features)\n        \n    valid_features = [\n        f for f in all_features\n        if f.get(\"geometry\") is not None]\n\n    return gpd.GeoDataFrame.from_features(valid_features, crs=crs)\n\n\n# Read in service for NGA roads\nurl = \"https://services3.arcgis.com/BU6Aadhn6tbBEdyk/arcgis/rest/services/GRID3_NGA_roads/FeatureServer/0/query\"\n\nboundbox =  {\n        \"xmin\": 360102.4944,\n        \"ymin\": 725614.4996,\n        \"xmax\": 381199.1042,\n        \"ymax\": 746837.3928  }\n\n\n\ngdf = fetch_nga_roads(boundbox, crs=\"EPSG:3857\", record_limit=1000, url=url)\n\ngdf.head()\n\n\n\n\n\n\n\n\ngeometry\nOBJECTID\nid\ncountry\niso3\nsource_id\nclass\nspeed_estimate\nspeed_estimate_method\nroad_surface\nnames\nsubclass\nspeed_limits\ndate\nsource_acronym\nShape__Length\n\n\n\n\n0\nLINESTRING (3.353 6.561, 3.352 6.564, 3.351 6....\n375\n0825887fffffffff047f4f4e7c46bb8d\nNigeria\nNGA\nOverture / OSM\nunclassified\n40\nliterature review\n\n\n\n\n2025\nOVERTURE_OSM_001\n660.977176\n\n\n1\nLINESTRING (3.394 6.653, 3.395 6.653, 3.396 6....\n2121\n0835882fffffffff046f5d76209c94af\nNigeria\nNGA\nOverture / OSM\nmotorway\n80\nGPS\npaved\nLagos-Ibadan Expressway\n\n\n2025\nOVERTURE_OSM_001\n4708.736787\n\n\n2\nLINESTRING (3.375 6.664, 3.375 6.665)\n2129\n0835882fffffffff046ffcc2abaf4fde\nNigeria\nNGA\nOverture / OSM\nresidential\n20\nliterature review\nunpaved\n\n\n\n2025\nOVERTURE_OSM_001\n65.118153\n\n\n3\nLINESTRING (3.39 6.68, 3.39 6.68, 3.39 6.679, ...\n2130\n0835882fffffffff046fff468b9d4a49\nNigeria\nNGA\nOverture / OSM\ntrack\n10\nliterature review\nunpaved\n\n\n\n2025\nOVERTURE_OSM_001\n1929.374551\n\n\n4\nLINESTRING (3.414 6.689, 3.413 6.688, 3.413 6....\n2152\n0835882fffffffff047f5f6082b04656\nNigeria\nNGA\nOverture / OSM\nmotorway\n80\nGPS\npaved\nLagos-Ibadan Expressway\n\n\n2025\nOVERTURE_OSM_001\n4815.947415\n\n\n\n\n\n\n\n\n# Plot roads\n# size \nplt.figure(figsize=(6, 4), dpi=120)\ngdf.plot()\n\n&lt;Figure size 720x480 with 0 Axes&gt;\n\n\n\n\n\n\n\n\n\n\nexploded_road_gdf = gdf.copy()\n\nexploded_road_gdf = exploded_road_gdf.set_crs(epsg=4326, allow_override=True)\n    \nexploded_road_gdf = exploded_road_gdf.to_crs('EPSG:3857')\n\nexploded_road_gdf = exploded_road_gdf.explode(index_parts=True) \n\n\nexploded_road_gdf['length_meters'] = exploded_road_gdf.geometry.length \n\n# Build network\nGs = momepy.gdf_to_nx(\n    exploded_road_gdf,\n    directed='MultiDiGraph',           \n    approach='primal',\n    integer_labels=True,\n    preserve_index=True,\n    length='length_meters'        \n)\n\n\n# üîß OSMnx compatibility: alias length_meters ‚Üí length\nfor _, _, data in Gs.edges(data=True):\n    data[\"length\"] = data[\"length_meters\"] \n\n\n\n\n# # Back to GeoDataFrames\nnodes, edges = momepy.nx_to_gdf(Gs, points=True, lines=True)\n \n\n# # Try roundabout simplification\nedges = momepy.roundabout_simplification(edges)\n \n \nedges.head()\n\n\n\n\n\n\n\n\nOBJECTID\nid\ncountry\niso3\nsource_id\nclass\nspeed_estimate\nspeed_estimate_method\nroad_surface\nnames\n...\nspeed_limits\ndate\nsource_acronym\nShape__Length\ngeometry\nlength_meters\nlength\nnode_start\nnode_end\nsimplification_group\n\n\n\n\n(0, 0)\n375\n0825887fffffffff047f4f4e7c46bb8d\nNigeria\nNGA\nOverture / OSM\nunclassified\n40\nliterature review\n\n\n...\n\n2025\nOVERTURE_OSM_001\n660.977176\nLINESTRING (373284.209 731941.259, 373142.699 ...\n660.977176\n660.977176\n0\n1\n&lt;NA&gt;\n\n\n(1, 0)\n2121\n0835882fffffffff046f5d76209c94af\nNigeria\nNGA\nOverture / OSM\nmotorway\n80\nGPS\npaved\nLagos-Ibadan Expressway\n...\n\n2025\nOVERTURE_OSM_001\n4708.736787\nLINESTRING (377835.061 742222.484, 377903.879 ...\n4708.736787\n4708.736787\n2\n3\n&lt;NA&gt;\n\n\n(2, 0)\n2129\n0835882fffffffff046ffcc2abaf4fde\nNigeria\nNGA\nOverture / OSM\nresidential\n20\nliterature review\nunpaved\n\n...\n\n2025\nOVERTURE_OSM_001\n65.118153\nLINESTRING (375667.815 743564.588, 375679.303 ...\n65.118153\n65.118153\n4\n5\n&lt;NA&gt;\n\n\n(3, 0)\n2130\n0835882fffffffff046fff468b9d4a49\nNigeria\nNGA\nOverture / OSM\ntrack\n10\nliterature review\nunpaved\n\n...\n\n2025\nOVERTURE_OSM_001\n1929.374551\nLINESTRING (377331.652 745306.289, 377349.007 ...\n1929.374551\n1929.374551\n6\n7\n&lt;NA&gt;\n\n\n(4, 0)\n2152\n0835882fffffffff047f5f6082b04656\nNigeria\nNGA\nOverture / OSM\nmotorway\n80\nGPS\npaved\nLagos-Ibadan Expressway\n...\n\n2025\nOVERTURE_OSM_001\n4815.947415\nLINESTRING (380005.724 746285.084, 379966.54 7...\n4815.947415\n4815.947415\n8\n9\n&lt;NA&gt;\n\n\n\n\n5 rows √ó 21 columns\n\n\n\n\n\n# check simplification group\nedges['simplification_group'].value_counts()\n \n\nsimplification_group\n60    16\n84    16\n39    16\n47    14\n81    14\n      ..\n21     2\n57     2\n63     2\n23     2\n31     2\nName: count, Length: 98, dtype: Int64\n\n\n\nfig, ax = plt.subplots(figsize=(6, 4), dpi=120)\n\nedges.plot(ax=ax, color=\"gray\", lw=0.5)\nnodes.plot(ax=ax, color=\"green\", markersize=0.5)\n\nplt.show()\n\n\n\n\n\n\n\n\n\n# Calculate time to traverse a road segment in minutes using the speed estimate and length\nedges[\"travel_time_mins\"] = ((edges[\"length_meters\"]/1000) / (edges[\"speed_estimate\"])) * 60\n\n# drop if travel_time_mins is infinite or NaN or less than equal to zero\nedges = edges.replace([np.inf, -np.inf], np.nan)\nedges = edges.dropna(subset=['travel_time_mins'])\nedges = edges[edges['travel_time_mins'] &gt; 0]    \n\nedges.head()\n\n\n\n\n\n\n\n\nOBJECTID\nid\ncountry\niso3\nsource_id\nclass\nspeed_estimate\nspeed_estimate_method\nroad_surface\nnames\n...\ndate\nsource_acronym\nShape__Length\ngeometry\nlength_meters\nlength\nnode_start\nnode_end\nsimplification_group\ntravel_time_mins\n\n\n\n\n(0, 0)\n375\n0825887fffffffff047f4f4e7c46bb8d\nNigeria\nNGA\nOverture / OSM\nunclassified\n40\nliterature review\n\n\n...\n2025\nOVERTURE_OSM_001\n660.977176\nLINESTRING (373284.209 731941.259, 373142.699 ...\n660.977176\n660.977176\n0\n1\n&lt;NA&gt;\n0.991466\n\n\n(1, 0)\n2121\n0835882fffffffff046f5d76209c94af\nNigeria\nNGA\nOverture / OSM\nmotorway\n80\nGPS\npaved\nLagos-Ibadan Expressway\n...\n2025\nOVERTURE_OSM_001\n4708.736787\nLINESTRING (377835.061 742222.484, 377903.879 ...\n4708.736787\n4708.736787\n2\n3\n&lt;NA&gt;\n3.531553\n\n\n(2, 0)\n2129\n0835882fffffffff046ffcc2abaf4fde\nNigeria\nNGA\nOverture / OSM\nresidential\n20\nliterature review\nunpaved\n\n...\n2025\nOVERTURE_OSM_001\n65.118153\nLINESTRING (375667.815 743564.588, 375679.303 ...\n65.118153\n65.118153\n4\n5\n&lt;NA&gt;\n0.195354\n\n\n(3, 0)\n2130\n0835882fffffffff046fff468b9d4a49\nNigeria\nNGA\nOverture / OSM\ntrack\n10\nliterature review\nunpaved\n\n...\n2025\nOVERTURE_OSM_001\n1929.374551\nLINESTRING (377331.652 745306.289, 377349.007 ...\n1929.374551\n1929.374551\n6\n7\n&lt;NA&gt;\n11.576247\n\n\n(4, 0)\n2152\n0835882fffffffff047f5f6082b04656\nNigeria\nNGA\nOverture / OSM\nmotorway\n80\nGPS\npaved\nLagos-Ibadan Expressway\n...\n2025\nOVERTURE_OSM_001\n4815.947415\nLINESTRING (380005.724 746285.084, 379966.54 7...\n4815.947415\n4815.947415\n8\n9\n&lt;NA&gt;\n3.611961\n\n\n\n\n5 rows √ó 22 columns\n\n\n\n\n\nfig, (ax1, ax2) = plt.subplots(ncols=2, figsize=(7, 4), dpi=100)\n\n# --- Plot speed estimate ---\nedges.plot(\n    column=\"speed_estimate\",\n    legend=True,\n    ax=ax1,\n    cmap=\"viridis\",\n)\nax1.set_title(\"Speed (km/h)\", fontsize=9)\nax1.tick_params(labelsize=7)\n\nleg1 = ax1.get_legend()\nif leg1:\n    leg1.set_loc(\"lower left\")\n    leg1.set_title(\"Speed (km/h)\", prop={\"size\": 8})\n    for txt in leg1.get_texts():\n        txt.set_fontsize(7)\n\n# --- Plot travel time ---\nedges.plot(\n    column=\"travel_time_mins\",\n    legend=True,\n    ax=ax2,\n    cmap=\"inferno\",\n    scheme=\"natural_breaks\",\n)\nax2.set_title(\"Travel Time (Minutes)\", fontsize=9)\nax2.tick_params(labelsize=7)\n\nleg2 = ax2.get_legend()\nif leg2:\n    leg2.set_loc(\"lower right\")\n    leg2.set_title(\"Minutes\", prop={\"size\": 8})\n    for txt in leg2.get_texts():\n        txt.set_fontsize(7)\n\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nfrom pyproj import Transformer\n\n# Geocode an origin and destination address\n# Origin\norig_address = \"Oshitelu St, Lagos, Nigeria\"\n\norig_y, orig_x = ox.geocode(orig_address)  # notice the coordinate order (y, x)!\n\n# Destination\ndest_address = \"Obafemi Awolowo Wy, Lagos, Nigeria\"\ndest_y, dest_x = ox.geocode(dest_address) \n\n\n# Transformer: lon/lat ‚Üí graph CRS\ntransformer = Transformer.from_crs(\n    \"EPSG:4326\",\n    Gs.graph[\"crs\"],\n    always_xy=True\n)\n\n# Print coordinates\nprint(\"Origin coords:\", orig_x, orig_y)\nprint(\"Destination coords:\", dest_x, dest_y)\n\norig_x_p, orig_y_p = transformer.transform(orig_x, orig_y)\ndest_x_p, dest_y_p = transformer.transform(dest_x, dest_y)\n\n# Snap to graph\norig_node_id, dist_to_orig = ox.distance.nearest_nodes(\n    Gs, X=orig_x_p, Y=orig_y_p, return_dist=True\n)\ndest_node_id, dist_to_dest = ox.distance.nearest_nodes(\n    Gs, X=dest_x_p, Y=dest_y_p, return_dist=True\n)\n\n# Print distance to nearest node\nprint(\"Origin node-id:\", orig_node_id, \"and distance:\", dist_to_orig, \"meters.\")\nprint(\"Destination node-id:\", dest_node_id, \"and distance:\", dist_to_dest, \"meters.\")\n\n\n\n\n# Calculate shortest path between origin and destionation nodes and the length\npath = nx.shortest_path(Gs, source=orig_node_id, target=dest_node_id, weight='travel_time_mins')\nlength = nx.shortest_path_length(Gs, source=orig_node_id, target=dest_node_id, weight='travel_time_mins')\n\n\n\n\nOrigin coords: 3.339861 6.5943937\nDestination coords: 3.3511002 6.6082757\nOrigin node-id: 15790 and distance: 69.41404267339831 meters.\nDestination node-id: 30133 and distance: 49.45782604997911 meters.\n\n\n\n# Shortest path based on distance\nfig, ax = ox.plot_graph_route(Gs, path, figsize=(5,5), dpi=120  )\n\n# Add the travel time as title\nax.set_xlabel(\"Shortest path is {t: .1f} minutes.\".format(t=length))\n\n#show plot\nplt.show()\n\n\n\n\n\n\n\n\n\n# Explore graph edges and route together in a single map\nroute_edges = ox.routing.route_to_gdf(Gs, path, weight='length')\n\nm = edges.explore(color=\"black\", tiles=\"cartodbdarkmatter\")\nm = route_edges.explore(m=m, color=\"maroon\", style_kwds={\"weight\": 5})\n\n# Add the Esri World Imagery tile layer\nfolium.TileLayer(\n    tiles='https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n    attr='Esri',\n    name='Esri Satellite',\n    overlay=False,\n    control=True\n).add_to(m)\n\n# Add a layer control to toggle between tile layers\nfolium.LayerControl().add_to(m)\nm\n\n\n# Read in Nigeria health facilities layer\nlayer_url = \"https://services3.arcgis.com/BU6Aadhn6tbBEdyk/arcgis/rest/services/GRID3_NGA_health_facilities_v2_0/FeatureServer/0/query\"\n \n\n# Create bounding box\nquery_extent = {\n    \"xmin\": 3.328171,\n    \"ymin\": 6.582383,\n    \"xmax\": 3.383102,\n    \"ymax\": 6.633909}\n\n\n\nhealth_fac = fetch_nga_roads(query_extent, crs=\"EPSG:4326\", record_limit=200000, url=layer_url)\n\n \n\nhealth_fac.head(5)\n\n\n\n\n\n\n\n\ngeometry\nOBJECTID\nglobalid\nnhfr_uid\nnhfr_facility_code\ncountry\niso\nstate\nlga\nlga_name_disagreement\n...\nfacility_name\nfacility_name_source\nownership\nownership_type\nfacility_level\nfacility_level_option\nlatitude\nlongitude\ngeocoordinates_source\nlast_updated\n\n\n\n\n0\nPOINT (3.34985 6.59825)\n151\nd34b8933-7c5c-45e6-a59e-f8108b3a8e58\n62363642.0\n24/11/1/1/2/0020\nNigeria\nNGA\nLagos\nIkeja\n0\n...\nLife Health Care Clinic\nNHFR_2024\nPrivate\nUnknown\nPrimary\nPrimary Health Center\n6.598250\n3.349850\nGRID3_EHEALTH\n2024-11-11\n\n\n1\nPOINT (3.36239 6.58945)\n589\n3854bf39-0017-4008-8095-dd6ac833cbe9\n39876675.0\n24/11/1/1/1/0022\nNigeria\nNGA\nLagos\nIkeja\n0\n...\nOpebi Primary Health Center\nNHFR_2024\nPublic\nUnknown\nPrimary\nPrimary Health Center\n6.589447\n3.362393\nGRID3_EHEALTH\n2024-11-11\n\n\n2\nPOINT (3.36413 6.60097)\n594\n3167880d-17be-4b24-ba45-d5a61abe160a\n52365838.0\n24/11/1/1/1/0018\nNigeria\nNGA\nLagos\nIkeja\n0\n...\nOregun Primary Health Center\nNHFR_2024\nPublic\nUnknown\nPrimary\nPrimary Health Center\n6.600967\n3.364128\nGRID3_EHEALTH\n2024-11-11\n\n\n3\nPOINT (3.33843 6.59715)\n596\n4c0b8011-af9c-4d55-bbc4-4f9aa2fbe04a\n13500518.0\n24/11/1/1/1/0009\nNigeria\nNGA\nLagos\nIkeja\n0\n...\nIkeja Primary Health Center\nNHFR_2024\nPublic\nLocal Government\nPrimary\nPrimary Health Center\n6.597150\n3.338432\nGRID3_EHEALTH\n2024-11-11\n\n\n4\nPOINT (3.3423 6.63057)\n670\n4eef270b-e351-4cf2-bf60-ff31051dd22b\n77159777.0\n24/11/1/1/1/0011\nNigeria\nNGA\nLagos\nIkeja\n0\n...\nOgba Primary Health Center\nNHFR_2024\nPublic\nLocal Government\nPrimary\nPrimary Health Center\n6.630571\n3.342302\nGRID3_EHEALTH\n2024-11-11\n\n\n\n\n5 rows √ó 22 columns\n\n\n\n\n# Read in Nigeria schools layer\nlayer_url = \"https://services3.arcgis.com/BU6Aadhn6tbBEdyk/arcgis/rest/services/Schools_in_Nigeria/FeatureServer/0/query\"\n# feature_layer = FeatureLayer(layer_url)\n\n# Create bounding box\nquery_extent = {\n    \"xmin\": 3.328171,\n    \"ymin\": 6.582383,\n    \"xmax\": 3.383102,\n    \"ymax\": 6.633909,\n     \n}\n \nschools = fetch_nga_roads(query_extent, crs=\"EPSG:4326\", record_limit=200000, url=layer_url)\n\nschools.head(5)\n\n\n\n\n\n\n\n\ngeometry\nFID\nglobalid\nuniq_id\ntimestamp\neditor\nwardname\nwardcode\nlganame\nlgacode\n...\nsecondary_\nstudent_ct\nteacher_ct\npoi_type\neducation\nmanagement\nsubtype\ncategory\nname\nsource\n\n\n\n\n0\nPOINT (3.34134 6.6304)\n61\n7a4b0b1e-3732-4674-b129-f6048d8a0ec0\n842635\n1607644800000\nnajib.adam\nOgba / Oluwole\nLASIKA07\nIkeja\n25011\n...\n\n\n\nSchool\nFormal\nPublic\nStandard\nMixed\nOgba Primary and Secondary School\nOSGOF\n\n\n1\nPOINT (3.33565 6.60116)\n345\n77b5417d-df45-4e3f-b850-8e5eb1762a25\n842947\n1607644800000\nnajib.adam\nAnifowoshe\nLASIKA05\nIkeja\n25011\n...\n\n\n\nSchool\nFormal\nPrivate\nStandard\nPrimary\nOlufunmilayo Nursery And Primary School\nGRID\n\n\n2\nPOINT (3.33294 6.62794)\n377\nb89c364f-d3fa-4c92-9de0-ee1c13cab316\n842979\n1607644800000\nnajib.adam\nIjaiye / Ifako\nLASIOE10\nIfako/Ijaye\n25010\n...\n\n85\n6\nSchool\nFormal\nPrivate\nStandard\nPrimary\nGreat Talents Nursery And Primary School\nGRID\n\n\n3\nPOINT (3.33544 6.62886)\n2178\na4ce123c-53b2-4a53-9be2-9994cd826e22\n844889\n1607644800000\nnajib.adam\nIjaiye / Ifako\nLASIOE10\nIfako/Ijaye\n25010\n...\n\n80\n8\nSchool\nFormal\nPrivate\nStandard\nPrimary\nJnissi Nursery And Primary School Lsdpc Estate\nGRID\n\n\n4\nPOINT (3.35361 6.63257)\n2200\n5e9dd4d0-8bbd-47c2-bc58-3e14bc8cd81d\n844910\n1607644800000\nnajib.adam\nOgba / Oluwole\nLASIKA07\nIkeja\n25011\n...\n\n\n\nSchool\nFormal\nPrivate\nStandard\nPrimary\nMd Nursery And Primary School\nGRID\n\n\n\n\n5 rows √ó 22 columns\n\n\n\n\n#set same crs as graph\nschools = schools.to_crs(Gs.graph[\"crs\"])\nhealth_fac = health_fac.to_crs(Gs.graph[\"crs\"])\n\nschools[\"longitude\"] = schools.geometry.x\nschools[\"latitude\"] = schools.geometry.y\n\nhealth_fac[\"longitude\"] = health_fac.geometry.x\nhealth_fac[\"latitude\"] = health_fac.geometry.y\n\n\n# Caclulate shortest route between every school and health facility using the travel_time_mins variable as the weight\n# this can take a few minutes\n\nweight_attribute = 'travel_time_mins'\n\n# Find nearest nodes to each school and health facility\norig_node_id, dist_to_orig = ox.distance.nearest_nodes(\n    Gs, \n    X=schools.geometry.x, Y=schools.geometry.y, return_dist=True)\ndest_node_id, dist_to_dest = ox.distance.nearest_nodes(Gs, X=health_fac.geometry.x, Y=health_fac.geometry.y, return_dist=True)\n\nshortest_paths = {}\n\nfor source in orig_node_id:\n    for target in dest_node_id:\n        try:\n            # Get the actual path\n            path = nx.shortest_path(Gs, source=source, target=target, weight=weight_attribute)\n            # Get the path length\n            length = nx.shortest_path_length(Gs, source=source, target=target, weight=weight_attribute)\n            shortest_paths[(source, target)] = {'path': path, 'length': length}\n        except nx.NetworkXNoPath:\n          # build dictionary with shortest routes\n            shortest_paths[(source, target)] = {'path': None, 'length': float('inf')}\n \n\nprint(\"Unique school nodes:\", len(set(orig_node_id)))\nprint(\"Unique facility nodes:\", len(set(dest_node_id)))\nprint(\"Snap distances (schools):\", dist_to_orig.min(), dist_to_orig.max())\nprint(\"Snap distances (facilities):\", dist_to_dest.min(), dist_to_dest.max())\n\n\nUnique school nodes: 224\nUnique facility nodes: 153\nSnap distances (schools): 1.0962485485910776 116.9630130515727\nSnap distances (facilities): 0.0 118.8161232238598\n\n\n\n# create dataframe of shortest paths between every school and health facility and drop school/health facility combinations that aren't the closest\n \n# build dataframe\ndf = pd.DataFrame(shortest_paths).T\ndf = df.reset_index()\ndf = df.rename(columns={'level_0': 'school_node', 'level_1': 'health_facility_node'})\ndf = df.replace([np.inf, -np.inf], np.nan)\n\n# sort by length and keep only the shortest routes for each school\ndf = df.sort_values(by=['school_node', 'length'], ascending=[True, True])\ndf = df.drop_duplicates(subset=['school_node'], keep='first')\ndf.head(5)\n\n\n\n\n\n\n\n\nschool_node\nhealth_facility_node\npath\nlength\n\n\n\n\n33384\n83\n30027\n[83, 84, 124, 160, 13322, 47675, 42536, 13314,...\n18.0\n\n\n624\n116\n116\n[116]\n0.0\n\n\n1057\n221\n15747\n[221, 222, 3836, 3837, 15788, 15747]\n5.0\n\n\n17962\n643\n183\n[643, 17917, 5788, 661, 5793, 13140, 183]\n6.0\n\n\n28450\n712\n712\n[712]\n0.0\n\n\n\n\n\n\n\n\n# merge nearest node ID back to schools and health facitility geodataframes\n\n# set node ids\nschools['node_id'] = orig_node_id\nhealth_fac['node_id'] = dest_node_id\n\n# get only columns needed for merge\nschool_merge = schools[['node_id', 'name','latitude','longitude']]\nhealth_merge = health_fac[['node_id', 'facility_name']]\n\n# merge nearest routes with school and health facility information\nnearest_df = df.merge(school_merge, left_on='school_node', right_on='node_id')\nnearest_df = nearest_df.merge(health_merge, left_on='health_facility_node', right_on='node_id')\n\n# drop duplicates\nnearest_df1 = nearest_df.drop_duplicates(subset=['school_node', 'length'])\nnearest_df1.head()\n\n\n\n\n\n\n\n\nschool_node\nhealth_facility_node\npath\nlength\nnode_id_x\nname\nlatitude\nlongitude\nnode_id_y\nfacility_name\n\n\n\n\n0\n83\n30027\n[83, 84, 124, 160, 13322, 47675, 42536, 13314,...\n18.0\n83\nPrime Achievers Academy\n740135.670587\n374852.800503\n30027\nIkosi Isheri Mutual Health Plan\n\n\n1\n116\n116\n[116]\n0.0\n116\nMd Nursery And Primary School\n739988.537463\n373322.421393\n116\nThe Brighthope Hospital Specialist\n\n\n2\n221\n15747\n[221, 222, 3836, 3837, 15788, 15747]\n5.0\n221\nAnifowoshe Primary School Ikeja\n736429.645181\n371129.163511\n15747\nGod'S Love Hospital\n\n\n3\n643\n183\n[643, 17917, 5788, 661, 5793, 13140, 183]\n6.0\n643\nEden Montessori School\n739945.318972\n374112.520483\n183\nAmazing Grace Medical Center\n\n\n5\n712\n712\n[712]\n0.0\n712\nStepping Stone Montessori\n736576.783257\n373368.577763\n712\nAgeless Physio Clinic\n\n\n\n\n\n\n\n\n# visualize all nearest routes\n\n# drop routes with nans\nnearest_df1 = nearest_df1.dropna(subset=['path'])\n\n# convert to list\nroutes = nearest_df1['path'].tolist()\n\n# set route colors\nnum_paths = len(routes)\ncolor_pool = list(mcolors.CSS4_COLORS.values()) # 148+ colors\npath_colors = random.choices(color_pool, k=num_paths)\n\n# plot map\n\ntransformer = Transformer.from_crs(\"EPSG:4326\", \"EPSG:3857\", always_xy=True)\n\nxmin, ymin = transformer.transform(3.328171, 6.582383)\nxmax, ymax = transformer.transform(3.383102, 6.633909)\n\nbbox_3857 = (xmin, ymin, xmax, ymax)\n    \nfig, ax = ox.plot_graph_routes(Gs, routes,route_colors=path_colors, route_linewidth=6, node_size=0, bbox=bbox_3857, figsize=(6,4), dpi=120)\n\nplt.show()\n\n\n\n\n\n\n\n\n\n# Explore a route interactively\n\n# select school to view\nnearest_df1_s = nearest_df1[nearest_df1['name'] == 'Saint Joseph Secondary School']\n\nroute_edges = ox.routing.route_to_gdf(Gs, nearest_df1_s.iloc[0].path, weight='length')\n\n# map facilities, roads, and routes\nm = edges.explore(color=\"black\", tiles=\"cartodbdarkmatter\")\nm = route_edges.explore(m=m, color=\"yellow\", style_kwds={\"weight\": 5})\nm = schools.explore(m=m, color = \"blue\", style_kwds={\"weight\": 5})\nm = health_fac.explore(m=m, color = \"red\", style_kwds={\"weight\": 5})\n# add the Esri World Imagery tile layer to interactive map\nfolium.TileLayer(\n    tiles='https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n    attr='Esri',\n    name='Esri Satellite',\n    overlay=False,\n    control=True\n).add_to(m)\n\n# add a layer control to toggle between tile layers\nfolium.LayerControl().add_to(m)\nm\n\n\n# Map the travel time from each school to the nearset health facility - darker dots are closer to a health facility, red dots are health facilities\n\n# construct geodataframe\ngeometry = gpd.points_from_xy(nearest_df1['longitude'], nearest_df1['latitude'])\nnearest_gdf = gpd.GeoDataFrame(nearest_df1, geometry=geometry, crs='EPSG:4326')\n\nedges_plot = edges.to_crs(epsg=4326)\nhealth_plot = health_fac.to_crs(epsg=4326)\n\n\n# Plot with length column for travel time\nfig, ax = plt.subplots(1, 1, figsize=(5, 5), dpi=120)\nedges.plot(ax=ax, color='grey', alpha=.1, zorder=1)\nhealth_fac.plot(marker='+', color='red', legend=True, ax=ax, markersize=5, zorder=3)\nnearest_gdf.plot(column='length', cmap='inferno', legend=True, ax=ax, markersize=25, zorder=2)\nplt.title(\"Time from school to nearest health facility\")\nax.set_xlim(bbox_3857[0], bbox_3857[2])\nax.set_ylim(bbox_3857[1], bbox_3857[3]  )\nplt.show()",
    "crumbs": [
      "Home",
      "Analysis",
      "GRID3 Nigeria Road Network Analysis"
    ]
  },
  {
    "objectID": "index.html#video-overview",
    "href": "index.html#video-overview",
    "title": "GRID3 Data Science User Guide",
    "section": "2.1 Video Overview",
    "text": "2.1 Video Overview",
    "crumbs": [
      "Home",
      "Getting Started",
      "GRID3 Data Science User Guide"
    ]
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "GRID3 Data Science User Guide",
    "section": "2.2 üöÄ Getting started",
    "text": "2.2 üöÄ Getting started\nIf you‚Äôre new, start here. This is the full catalog of notebooks in the guide.\nThese notebooks walk through: - Querying a GRID3 Feature Service - Converting responses to GeoDataFrames - Visualizing results with Folium - Analyzing road networks with OSMnx - Much more!\n\n\n\n\n2.2.1 üìö User Guide Template\nA template for creating GRID3 data user guides.\nView the template ‚Üí\n\n\n2.2.2 üõ£Ô∏è Friction Surface by LGA\nAccess and analyze GRID3 friction surfaces at the Local Government Area (LGA) level in Nigeria.\nView the guide ‚Üí\n\n\n\n2.2.3 üìä Road Network Analysis\nCommon patterns for spatial and tabular analysis.\nAPI Nigeria Road Network Analysis\n\n\n2.2.4 üó∫Ô∏è Visualization\nCreate interactive and static maps with Folium and GeoPandas.\nView mapping guides ‚Üí",
    "crumbs": [
      "Home",
      "Getting Started",
      "GRID3 Data Science User Guide"
    ]
  },
  {
    "objectID": "notebooks/acessing_friction_surface_by_lga.html",
    "href": "notebooks/acessing_friction_surface_by_lga.html",
    "title": "Mapping GRID3 Friction Surfaces by LGA in Nigeria",
    "section": "",
    "text": "This lesson demonstrates how to use GRID3 data to map and analyze friction surfaces at the Local Government Area (LGA) level in Nigeria. It walks through accessing GRID3 Raster Friction Surface and administrative boundaries data, then clipping and visualizing a friction surface for a selected LGA in a reproducible workflow."
  },
  {
    "objectID": "notebooks/acessing_friction_surface_by_lga.html#overview",
    "href": "notebooks/acessing_friction_surface_by_lga.html#overview",
    "title": "Mapping GRID3 Friction Surfaces by LGA in Nigeria",
    "section": "",
    "text": "This lesson demonstrates how to use GRID3 data to map and analyze friction surfaces at the Local Government Area (LGA) level in Nigeria. It walks through accessing GRID3 Raster Friction Surface and administrative boundaries data, then clipping and visualizing a friction surface for a selected LGA in a reproducible workflow."
  },
  {
    "objectID": "notebooks/acessing_friction_surface_by_lga.html#data",
    "href": "notebooks/acessing_friction_surface_by_lga.html#data",
    "title": "Mapping GRID3 Friction Surfaces by LGA in Nigeria",
    "section": "2 Data",
    "text": "2 Data\nThe lesson uses:\n\nGRID3 high-resolution friction surfaces (walking and mixed-mode)\nAdministrative boundaries for Nigerian states and LGAs\n\nFriction surfaces represent travel difficulty or cost across space, enabling realistic travel-time and accessibility modeling beyond road-network-only approaches."
  },
  {
    "objectID": "notebooks/acessing_friction_surface_by_lga.html#workflow-google-colab",
    "href": "notebooks/acessing_friction_surface_by_lga.html#workflow-google-colab",
    "title": "Mapping GRID3 Friction Surfaces by LGA in Nigeria",
    "section": "3 Workflow (Google Colab)",
    "text": "3 Workflow (Google Colab)\nImplemented in Google Colab, the notebook shows how to:\n\nQuery state and LGA boundaries from ArcGIS FeatureLayers\n\nSelect a state and LGA interactively\n\nDownload and extract GRID3 friction rasters\n\nClip the raster to the selected LGA\n\nExport a GeoTIFF and create publication-ready plots\n\nClear helper functions and comments make it easy to adapt for other regions or batch processing."
  },
  {
    "objectID": "notebooks/acessing_friction_surface_by_lga.html#learning-outcomes",
    "href": "notebooks/acessing_friction_surface_by_lga.html#learning-outcomes",
    "title": "Mapping GRID3 Friction Surfaces by LGA in Nigeria",
    "section": "4 Learning Outcomes",
    "text": "4 Learning Outcomes\nBy the end, users will be able to:\n\nUnderstand GRID3 friction datasets\n\nExtract and crop friction rasters to an LGA\n\nGenerate GeoTIFF outputs and visualizations for accessibility or infrastructure analysis\n\nCommon issues (e.g., CRS mismatches, empty queries, file extraction steps) are also highlighted."
  },
  {
    "objectID": "notebooks/acessing_friction_surface_by_lga.html#run-in-google-colab",
    "href": "notebooks/acessing_friction_surface_by_lga.html#run-in-google-colab",
    "title": "Mapping GRID3 Friction Surfaces by LGA in Nigeria",
    "section": "5 Run in Google Colab",
    "text": "5 Run in Google Colab\nOpen the lesson in Google Colab to execute the code and follow along with the analysis:"
  },
  {
    "objectID": "notebooks/friction_surface_by_LGA.html",
    "href": "notebooks/friction_surface_by_LGA.html",
    "title": "",
    "section": "",
    "text": "#No code selection of friction surface by LGA\n\n# @title Import libraries\n# install arcgis API for accessing data\n!pip install arcgis\n\nfrom arcgis.gis import GIS\nfrom arcgis.features import FeatureLayer\nfrom arcgis.geometry.filters import contains\nimport json\nimport arcgis\nimport matplotlib.pyplot as plt\n\nimport pandas as pd\nimport geopandas as gpd\n\nimport zipfile\nimport os\n\nfrom ipywidgets import Dropdown\nfrom IPython.display import display\n\n\nCollecting arcgis\n\n  Downloading arcgis-2.4.2-py3-none-any.whl.metadata (3.5 kB)\n\nRequirement already satisfied: pillow in /usr/local/lib/python3.12/dist-packages (from arcgis) (11.3.0)\n\nRequirement already satisfied: urllib3&lt;3,&gt;=2.1.0 in /usr/local/lib/python3.12/dist-packages (from arcgis) (2.5.0)\n\nRequirement already satisfied: cachetools in /usr/local/lib/python3.12/dist-packages (from arcgis) (7.0.1)\n\nRequirement already satisfied: lxml in /usr/local/lib/python3.12/dist-packages (from arcgis) (6.0.2)\n\nRequirement already satisfied: cryptography in /usr/local/lib/python3.12/dist-packages (from arcgis) (43.0.3)\n\nRequirement already satisfied: pandas&lt;2.4.0,&gt;=2.0.0 in /usr/local/lib/python3.12/dist-packages (from arcgis) (2.2.2)\n\nCollecting numpy&lt;3,&gt;=2.2.0 (from arcgis)\n\n  Downloading numpy-2.4.2-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (6.6 kB)\n\nRequirement already satisfied: matplotlib in /usr/local/lib/python3.12/dist-packages (from arcgis) (3.10.0)\n\nRequirement already satisfied: keyring&gt;=23.3.0 in /usr/local/lib/python3.12/dist-packages (from arcgis) (25.7.0)\n\nCollecting pylerc (from arcgis)\n\n  Downloading pylerc-4.0.tar.gz (738 kB)\n\n     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 738.5/738.5 kB 8.6 MB/s eta 0:00:00\n\n  Preparing metadata (setup.py) ... done\n\nCollecting ujson&gt;=3 (from arcgis)\n\n  Downloading ujson-5.11.0-cp312-cp312-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl.metadata (9.4 kB)\n\nCollecting truststore&gt;=0.10.0 (from arcgis)\n\n  Downloading truststore-0.10.4-py3-none-any.whl.metadata (4.4 kB)\n\nCollecting geomet&gt;=1.0.0 (from arcgis)\n\n  Downloading geomet-1.1.0-py3-none-any.whl.metadata (11 kB)\n\nRequirement already satisfied: requests&lt;3,&gt;=2.32.3 in /usr/local/lib/python3.12/dist-packages (from arcgis) (2.32.4)\n\nRequirement already satisfied: requests-oauthlib in /usr/local/lib/python3.12/dist-packages (from arcgis) (2.0.0)\n\nRequirement already satisfied: requests_toolbelt in /usr/local/lib/python3.12/dist-packages (from arcgis) (1.0.0)\n\nCollecting pyspnego&gt;=0.8.0 (from arcgis)\n\n  Downloading pyspnego-0.12.0-py3-none-any.whl.metadata (4.1 kB)\n\nCollecting dask&lt;2025.3,&gt;=2024.12.1 (from dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis)\n\n  Downloading dask-2025.2.0-py3-none-any.whl.metadata (3.8 kB)\n\nRequirement already satisfied: matplotlib-inline in /usr/local/lib/python3.12/dist-packages (from arcgis) (0.2.1)\n\nRequirement already satisfied: pyarrow&lt;21,&gt;=17 in /usr/local/lib/python3.12/dist-packages (from arcgis) (18.1.0)\n\nCollecting puremagic&lt;2,&gt;=1.15 (from arcgis)\n\n  Downloading puremagic-1.30-py3-none-any.whl.metadata (5.8 kB)\n\nRequirement already satisfied: pydantic&lt;3,&gt;=2.8.2 in /usr/local/lib/python3.12/dist-packages (from arcgis) (2.12.3)\n\nRequirement already satisfied: networkx&lt;4,&gt;=3.3 in /usr/local/lib/python3.12/dist-packages (from arcgis) (3.6.1)\n\nRequirement already satisfied: websocket-client&lt;2.0.0,&gt;=1.2.3 in /usr/local/lib/python3.12/dist-packages (from arcgis) (1.9.0)\n\nRequirement already satisfied: click&gt;=8.1 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (8.3.1)\n\nRequirement already satisfied: cloudpickle&gt;=3.0.0 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (3.1.2)\n\nRequirement already satisfied: fsspec&gt;=2021.09.0 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (2025.3.0)\n\nRequirement already satisfied: packaging&gt;=20.0 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (26.0)\n\nRequirement already satisfied: partd&gt;=1.4.0 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (1.4.2)\n\nRequirement already satisfied: pyyaml&gt;=5.3.1 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (6.0.3)\n\nRequirement already satisfied: toolz&gt;=0.10.0 in /usr/local/lib/python3.12/dist-packages (from dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (0.12.1)\n\nRequirement already satisfied: SecretStorage&gt;=3.2 in /usr/local/lib/python3.12/dist-packages (from keyring&gt;=23.3.0-&gt;arcgis) (3.5.0)\n\nRequirement already satisfied: jeepney&gt;=0.4.2 in /usr/local/lib/python3.12/dist-packages (from keyring&gt;=23.3.0-&gt;arcgis) (0.9.0)\n\nRequirement already satisfied: jaraco.classes in /usr/local/lib/python3.12/dist-packages (from keyring&gt;=23.3.0-&gt;arcgis) (3.4.0)\n\nRequirement already satisfied: jaraco.functools in /usr/local/lib/python3.12/dist-packages (from keyring&gt;=23.3.0-&gt;arcgis) (4.4.0)\n\nRequirement already satisfied: jaraco.context in /usr/local/lib/python3.12/dist-packages (from keyring&gt;=23.3.0-&gt;arcgis) (6.1.0)\n\nRequirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.12/dist-packages (from pandas&lt;2.4.0,&gt;=2.0.0-&gt;arcgis) (2.9.0.post0)\n\nRequirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.12/dist-packages (from pandas&lt;2.4.0,&gt;=2.0.0-&gt;arcgis) (2025.2)\n\nRequirement already satisfied: tzdata&gt;=2022.7 in /usr/local/lib/python3.12/dist-packages (from pandas&lt;2.4.0,&gt;=2.0.0-&gt;arcgis) (2025.3)\n\nRequirement already satisfied: annotated-types&gt;=0.6.0 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=2.8.2-&gt;arcgis) (0.7.0)\n\nRequirement already satisfied: pydantic-core==2.41.4 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=2.8.2-&gt;arcgis) (2.41.4)\n\nRequirement already satisfied: typing-extensions&gt;=4.14.1 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=2.8.2-&gt;arcgis) (4.15.0)\n\nRequirement already satisfied: typing-inspection&gt;=0.4.2 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=2.8.2-&gt;arcgis) (0.4.2)\n\nRequirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2.32.3-&gt;arcgis) (3.4.4)\n\nRequirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2.32.3-&gt;arcgis) (3.11)\n\nRequirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2.32.3-&gt;arcgis) (2026.1.4)\n\nRequirement already satisfied: cffi&gt;=1.12 in /usr/local/lib/python3.12/dist-packages (from cryptography-&gt;arcgis) (2.0.0)\n\nRequirement already satisfied: contourpy&gt;=1.0.1 in /usr/local/lib/python3.12/dist-packages (from matplotlib-&gt;arcgis) (1.3.3)\n\nRequirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.12/dist-packages (from matplotlib-&gt;arcgis) (0.12.1)\n\nRequirement already satisfied: fonttools&gt;=4.22.0 in /usr/local/lib/python3.12/dist-packages (from matplotlib-&gt;arcgis) (4.61.1)\n\nRequirement already satisfied: kiwisolver&gt;=1.3.1 in /usr/local/lib/python3.12/dist-packages (from matplotlib-&gt;arcgis) (1.4.9)\n\nRequirement already satisfied: pyparsing&gt;=2.3.1 in /usr/local/lib/python3.12/dist-packages (from matplotlib-&gt;arcgis) (3.3.2)\n\nRequirement already satisfied: traitlets in /usr/local/lib/python3.12/dist-packages (from matplotlib-inline-&gt;arcgis) (5.7.1)\n\nRequirement already satisfied: oauthlib&gt;=3.0.0 in /usr/local/lib/python3.12/dist-packages (from requests-oauthlib-&gt;arcgis) (3.3.1)\n\nRequirement already satisfied: pycparser in /usr/local/lib/python3.12/dist-packages (from cffi&gt;=1.12-&gt;cryptography-&gt;arcgis) (3.0)\n\nRequirement already satisfied: locket in /usr/local/lib/python3.12/dist-packages (from partd&gt;=1.4.0-&gt;dask&lt;2025.3,&gt;=2024.12.1-&gt;dask[dataframe]&lt;2025.3,&gt;=2024.12.1-&gt;arcgis) (1.0.0)\n\nRequirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&lt;2.4.0,&gt;=2.0.0-&gt;arcgis) (1.17.0)\n\nRequirement already satisfied: more-itertools in /usr/local/lib/python3.12/dist-packages (from jaraco.classes-&gt;keyring&gt;=23.3.0-&gt;arcgis) (10.8.0)\n\nDownloading arcgis-2.4.2-py3-none-any.whl (9.3 MB)\n\n   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 9.3/9.3 MB 50.3 MB/s eta 0:00:00\n\nDownloading dask-2025.2.0-py3-none-any.whl (1.4 MB)\n\n   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 1.4/1.4 MB 34.9 MB/s eta 0:00:00\n\nDownloading geomet-1.1.0-py3-none-any.whl (31 kB)\n\nDownloading numpy-2.4.2-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (16.6 MB)\n\n   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 16.6/16.6 MB 55.1 MB/s eta 0:00:00\n\nDownloading puremagic-1.30-py3-none-any.whl (43 kB)\n\n   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 43.3/43.3 kB 2.2 MB/s eta 0:00:00\n\nDownloading pyspnego-0.12.0-py3-none-any.whl (130 kB)\n\n   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 130.2/130.2 kB 6.0 MB/s eta 0:00:00\n\nDownloading truststore-0.10.4-py3-none-any.whl (18 kB)\n\nDownloading ujson-5.11.0-cp312-cp312-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl (57 kB)\n\n   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 57.4/57.4 kB 2.3 MB/s eta 0:00:00\n\nBuilding wheels for collected packages: pylerc\n\n  Building wheel for pylerc (setup.py) ... done\n\n  Created wheel for pylerc: filename=pylerc-4.0-py3-none-any.whl size=738090 sha256=c2626ec4e84bae3879d594e533600b5308986f285544947fcf89d1bfa733e8dd\n\n  Stored in directory: /root/.cache/pip/wheels/fa/44/c1/dee493b5ef79483d0276093205256ae13c97009c847e54c580\n\nSuccessfully built pylerc\n\nInstalling collected packages: puremagic, ujson, truststore, numpy, geomet, pylerc, dask, pyspnego, arcgis\n\n  Attempting uninstall: numpy\n\n    Found existing installation: numpy 2.0.2\n\n    Uninstalling numpy-2.0.2:\n\n      Successfully uninstalled numpy-2.0.2\n\n  Attempting uninstall: dask\n\n    Found existing installation: dask 2025.12.0\n\n    Uninstalling dask-2025.12.0:\n\n      Successfully uninstalled dask-2025.12.0\n\nERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n\ntensorflow 2.19.0 requires numpy&lt;2.2.0,&gt;=1.26.0, but you have numpy 2.4.2 which is incompatible.\n\nnumba 0.60.0 requires numpy&lt;2.1,&gt;=1.22, but you have numpy 2.4.2 which is incompatible.\n\nSuccessfully installed arcgis-2.4.2 dask-2025.2.0 geomet-1.1.0 numpy-2.4.2 puremagic-1.30 pylerc-4.0 pyspnego-0.12.0 truststore-0.10.4 ujson-5.11.0\n\n\n\n\nUnable to display output for mime type(s): application/vnd.colab-display-data+json\n\n\n\n# @title Select State\n# Import and select statename\n# Anonymously authenticate arcgis API\ngis = GIS()\n# Read in service for NGA roads\nlayer_url = \"https://services3.arcgis.com/BU6Aadhn6tbBEdyk/arcgis/rest/services/NGA_State_Boundaries_V2/FeatureServer/0\"\nfeature_layer = FeatureLayer(layer_url)\n\n# Convert to feature set and subset by bounding box\nfeat = feature_layer.query()\n\n# Convert to geojson\ngeojson_data = json.loads(feat.to_geojson)\n\n# Convert to geodataframe\nstate = gpd.GeoDataFrame.from_features(geojson_data['features'], crs=\"epsg:4326\")\n\nunique_states = state['statename'].unique()\n\n# Read in service for NGA roads\nlayer_url = \"https://services3.arcgis.com/BU6Aadhn6tbBEdyk/arcgis/rest/services/NGA_LGA_Boundaries_2/FeatureServer/0\"\nfeature_layer = FeatureLayer(layer_url)\n\n# Convert to feature set and subset by bounding box\nfeat = feature_layer.query()\n\n# Convert to geojson\ngeojson_data = json.loads(feat.to_geojson)\n\n# Convert to geodataframe\nlga = gpd.GeoDataFrame.from_features(geojson_data['features'], crs=\"epsg:4326\")\n\n# If lga name has / replace with _\nlga.lganame = lga.lganame.str.replace('/', '_')\n\nunique_lga = lga['lganame'].unique()\n\nstate_dropdown = Dropdown(options=unique_states, description='Select State:')\n\ndisplay(state_dropdown)\n\ncurrent_selected_state = None\n\ndef handle_dropdown_change(change):\n    global current_selected_state\n    if change['type'] == 'change' and change['name'] == 'value':\n        current_selected_state = change['new']\n\ndef get_lgas_in_state(state_name):\n    lgas_in_state = lga[lga['statename'] == state_name]\n    return sorted(lgas_in_state['lganame'].unique().tolist())\n\n# Test the function with the current selected state\nif 'current_selected_state' in locals() and current_selected_state:\n    filtered_lgas = get_lgas_in_state(current_selected_state)\n\nstate_dropdown.observe(handle_dropdown_change)\n\n\n\n\n\n# @title Select LGA using State Selection\n# Select LGA matching state name\ninitial_lga_options = []\n\nif 'current_selected_state' in locals() and current_selected_state:\n    initial_lga_options = get_lgas_in_state(current_selected_state)\n\nlga_dropdown = Dropdown(options=initial_lga_options, description='Select LGA:')\ndisplay(lga_dropdown)\n\ncurrent_selected_lga = lga_dropdown.value\n\ndef handle_lga_dropdown_change(change):\n    global current_selected_lga\n    if change['type'] == 'change' and change['name'] == 'value':\n        current_selected_lga = change['new']\n\nlga_dropdown.observe(handle_lga_dropdown_change)\n\n\n\n\n\n# @title Choose friction surface type to download\nfrom ipywidgets import Dropdown\nfrom IPython.display import display\n\n# Define the dropdown options\nfriction_surface_options = {\n    \"Walking-based friction surface\": \"1RhpIj3p77qpfpKVby8_UAqLn3JSt7dV0\",\n    \"Mixed friction surface\": \"1LyYkag3SKB8vop3cksuPcu66wzzCOlvm\"\n}\n\n# Create the dropdown widget\nfriction_dropdown = Dropdown(\n    options=friction_surface_options,\n    value=friction_surface_options[\"Mixed friction surface\"], # Default value\n    description='Select Friction Surface:'\n)\n\n# Initialize the variable to store the selected friction type\nselected_friction_type = friction_dropdown.value\n\ndef on_friction_dropdown_change(change):\n    global selected_friction_type\n    if change['type'] == 'change' and change['name'] == 'value':\n        selected_friction_type = change['new']\n\n# Observe changes in the dropdown\nfriction_dropdown.observe(on_friction_dropdown_change)\n\n# Display the dropdown\ndisplay(friction_dropdown)\n\n\n\n\n\n# @title Download friction surface into temporary drive files - only needs to be run once per runtime\n\n\n# Download and extract friction surface\n\n# Download raster\nfile_id = selected_friction_type\n!gdown --id {file_id}\n\n\n# Get correct file name for walking and mixed\nif selected_friction_type == \"1LyYkag3SKB8vop3cksuPcu66wzzCOlvm\":\n  zip_file_name = 'GRID3_NGA_mix_travel_time_friction_surface_v1_0.zip'\nif selected_friction_type == \"1RhpIj3p77qpfpKVby8_UAqLn3JSt7dV0\":\n  zip_file_name = 'GRID3_NGA_walk_travel_time_friction_surface_v1_0.zip'\n\n# Specify the directory where you want to extract the files\nextraction_path = '/content/extracted_data'\nos.makedirs(extraction_path, exist_ok=True)\n\n# Extract the zip file\nwith zipfile.ZipFile(zip_file_name, 'r') as zip_ref:\n    zip_ref.extractall(extraction_path)\n\nprint(f\"Files extracted to: {extraction_path}\")\nprint(\"Contents of extracted directory:\", os.listdir(extraction_path))\n\n/usr/local/lib/python3.12/dist-packages/gdown/__main__.py:139: FutureWarning: Option `--id` was deprecated in version 4.3.1 and will be removed in 5.0. You don't need to pass it anymore to use a file ID.\n  warnings.warn(\nDownloading...\nFrom (original): https://drive.google.com/uc?id=1LyYkag3SKB8vop3cksuPcu66wzzCOlvm\nFrom (redirected): https://drive.google.com/uc?id=1LyYkag3SKB8vop3cksuPcu66wzzCOlvm&confirm=t&uuid=d2afa603-a82f-4147-95e6-df8f21eb865d\nTo: /content/GRID3_NGA_mix_travel_time_friction_surface_v1_0.zip\n100% 3.22G/3.22G [00:46&lt;00:00, 70.0MB/s]\nFiles extracted to: /content/extracted_data\nContents of extracted directory: ['GRID3_NGA_mix_travel_time_friction_surface_v1_0']\n\n\n\n# @title Map friction surface for LGA\nif current_selected_lga:\n    # Subset the GeoDataFrame for the selected state\n    selected_lga_gdf = lga[lga['lganame'] == current_selected_lga]\n\n    # Get the bounding box of the selected state\n    # The .total_bounds property returns a tuple (minx, miny, maxx, maxy)\n    bbox = selected_lga_gdf.total_bounds\nfrom pyproj import Transformer\n\n# Define input and output CRS\ntransformer = Transformer.from_crs(\"EPSG:4326\", \"EPSG:32632\", always_xy=True)\n\n# Transform\nbbox = transformer.transform_bounds(*bbox)\n\n# Reshape bbox to be square\nminx, miny, maxx, maxy = bbox\nwidth = maxx - minx\nheight = maxy - miny\n\nif width &gt; height:\n    diff = width - height\n    miny -= diff / 2\n    maxy += diff / 2\nelif height &gt; width:\n    diff = height - width\n    minx -= diff / 2\n    maxx += diff / 2\n\nbbox = (minx, miny, maxx, maxy)\n\nimport rasterio\nfrom rasterio.windows import from_bounds\nfrom rasterio.plot import show\n\ndef read_window_with_bounds(input_raster_path, bounds, t):\n    minx, miny, maxx, maxy = bounds\n    with rasterio.open(input_raster_path) as src:\n        # Get the window corresponding to the bounds in the raster's CRS\n        window = from_bounds(minx, miny, maxx, maxy, src.transform)\n\n        # Read the data from that specific window\n        clipped_data = src.read(1,window=window)\n\n        transform=src.transform\n        crs=src.crs\n        profile = src.meta\n\n        return clipped_data, crs, transform, profile, t\n\n\n# Example Usage:\ntry:\n  if selected_friction_type == \"1LyYkag3SKB8vop3cksuPcu66wzzCOlvm\":\n    clipped_data, crs, transform, profile, t = read_window_with_bounds(\"/content/extracted_data/GRID3_NGA_mix_travel_time_friction_surface_v1_0/GRID3_NGA_mix_travel_time_friction_surface_v1_0.tif\", bbox, 1)\nexcept:\n  print('Mixed friction surface has not been extracted, rerun previous code block')\n\ntry:\n  if selected_friction_type == \"1RhpIj3p77qpfpKVby8_UAqLn3JSt7dV0\":\n    clipped_data, crs, transform, profile, t = read_window_with_bounds(\"/content/extracted_data/GRID3_NGA_walk_travel_time_friction_surface_v1_0.tif/GRID3_NGA_walk_travel_time_friction_surface_v1_0.tif\", bbox, 2)\nexcept:\n  print('Walking friction surface has not been extracted, rerun previous code block')\n\nimport rasterio.transform\n\n# Output numpy array to raster with original CRS\n# Define the output path for the GeoTIFF\nname = \"clipped_friction_surface_\"+ current_selected_lga + \"_\" + current_selected_state\noutput_geotiff_path = '/content/'+name+'.tif'\n\n# Update the profile dictionary with the correct dimensions and transform for clipped_data\nupdated_profile = profile.copy()\nupdated_profile['height'] = clipped_data.shape[0]\nupdated_profile['width'] = clipped_data.shape[1]\n\n# Recalculate the transform for the clipped data\n# bbox[0] is minx, bbox[3] is maxy (top-left y coordinate)\n# abs(transform.a) is x resolution, abs(transform.e) is y resolution\nupdated_profile['transform'] = rasterio.transform.from_origin(bbox[0], bbox[3], abs(transform.a), abs(transform.e))\nupdated_profile['count'] = 1 # The clipped_data is a single band (2D array)\n\n# Write the clipped_data NumPy array to a new GeoTIFF file\ntry:\n    with rasterio.open(output_geotiff_path, 'w', **updated_profile) as dst:\n        dst.write(clipped_data, 1) # Write to the first band\n    print(f\"Clipped friction surface successfully written to: {output_geotiff_path}\")\nexcept Exception as e:\n    print(f\"Error writing GeoTIFF: {e}\")\n\n# Read in clipped raster and plot\nwith rasterio.open(output_geotiff_path) as src:\n        if t == 1:\n          title = \"Mixed Travel Friction Surface for\" + \" \" + current_selected_lga + \", \" + current_selected_state\n\n        if t == 2:\n          title = \"Walking Travel Friction Surface for\" + \" \" + current_selected_lga + \", \" + current_selected_state\n\n        fig, ax = plt.subplots(figsize=(10, 5))\n\n        image = show(src, transform=transform, cmap='viridis', ax=ax, percent_range=(10, 70))\n\n        fig.colorbar(ax.get_images()[0], ax=ax, label='Values')\n        plt.title(title)\n        plt.show()\n\n\n\nClipped friction surface successfully written to: /content/clipped_friction_surface_Ogori_Magongo_Kogi.tif\n\n\n\n\n\n\n\n\n\n\n# @title Download clipped friction surface locally\nfrom google.colab import files\n\ntry:\n    files.download(output_geotiff_path)\n    print(f\"'{output_geotiff_path}' downloaded successfully.\")\nexcept Exception as e:\n    print(f\"Error downloading file: {e}\")\n\n\n\n\n\n\n\n'/content/clipped_friction_surface_Ogori_Magongo_Kogi.tif' downloaded successfully."
  }
]